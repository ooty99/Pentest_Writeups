==============================================
]]]]]]]]][[]]]]]]] Heist [[[[[[[[[]][[[[[[[[[[
==============================================
Start: 8-10-19
User: 
Root:

IP: 10.10.10.149
OS: Windows

Begin with nmap -sC -A 10.10.10.149 
Found more ports with -p- -T4
==============================================
Open ports: 80 (HTTP)
	    135 (RPC)
	    445 (SMB)
	    5985 (wsman)
	    49668 (unknown)
==============================================

<=---------<<<<<< PORTS >>>>>>---------=>

---+---+---+---+ 80 +---+---+---+---
Webpage 

---+---+---+---+ 135 +---+---+---+---
nmap banner grab = msrpc

---+---+---+---+ 445 +---+---+---+---


---+---+---+---+ 5985 +---+---+---+---
using telnet 10.10.10.149 5985 connects but fails when typing anything.

---+---+---+---+ 49668 +---+---+---+---



---------------------------------------------------------

Going to webpage on 80, login page. You can select login as guest to see a convo.

Convo mentions a user named hazard having problems with his cisco router

Clicking on the convo, then looking at the attachment, it looks like there are creds:

rout3r:0242114B0E143F015F5D1E161713
admin:02375012182C1A1D751618034F36415408

Attachment also mentions a secret with value:
$1$pdQG$o8nrSzsGXeaduXrjlvKc91

Hazard also asks the admin to make an account for him on the windows server so he can access the files.

Using http://www.ifm.net.nz/cookbooks/passwordcracker.html to crack type 7 passwords, i get

rout3r:$uperP@ssword
admin:Q4)sJu\Y8qz*A3?d

Used hashcat -m 500 hash.txt /root/HTB/Wordlists/14milPass.txt --force to crack the secret. 

$1$pdQG$o8nrSzsGXeaduXrjlvKc91:stealth1agent  

python smbclient.py hazard:stealth1agent@10.10.10.149 works

using login hazard, then entering stealth1agent grants a login session

impacket's lookupsid.py is the way to go. 
Combos:
.________________________________.
|Known people |     Password     |
|-------------|------------------|
|  hazard     |  stealth1agent   |
|  rout3r     |  $uperP@ssword   |
|  admin      | Q4)sJu\Y8qz*A3?d |
+================================+

hazard stealth1agent 
hazard $uperP@ssword
hazard Q4)sJu\Y8qz*A3?d
rout3r stealth1agent 
rout3r $uperP@ssword
rout3r Q4)sJu\Y8qz*A3?d
admin stealth1agent 
admin $uperP@ssword
admin Q4)sJu\Y8qz*A3?d

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Works:
python lookupsid.py heist/hazard:stealth1agent@10.10.10.149 -port 445

[*] Brute forcing SIDs at 10.10.10.149
[*] StringBinding ncacn_np:10.10.10.149[\pipe\lsarpc]
[*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112
500: SUPPORTDESK\Administrator (SidTypeUser)
501: SUPPORTDESK\Guest (SidTypeUser)
503: SUPPORTDESK\DefaultAccount (SidTypeUser)
504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)
513: SUPPORTDESK\None (SidTypeGroup)
1008: SUPPORTDESK\Hazard (SidTypeUser)
1009: SUPPORTDESK\support (SidTypeUser)
1012: SUPPORTDESK\Chase (SidTypeUser)
1013: SUPPORTDESK\Jason (SidTypeUser)











Full nmap results
============================================
Stats: 0:01:35 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.52% done; ETC: 19:44 (0:00:00 remaining)
Nmap scan report for 10.10.10.149
Host is up (0.21s latency).
Not shown: 997 filtered ports
PORT    STATE SERVICE       VERSION
80/tcp  open  http          Microsoft IIS httpd 10.0
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
| http-title: Support Login Page
|_Requested resource was login.php
135/tcp open  msrpc         Microsoft Windows RPC
445/tcp open  microsoft-ds?
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 1m15s, deviation: 0s, median: 1m15s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2019-08-10 19:45:36
|_  start_date: N/A

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   170.08 ms 10.10.12.1
2   242.75 ms 10.10.10.149

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 128.01 seconds
